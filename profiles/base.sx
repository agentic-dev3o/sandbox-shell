; sx base Seatbelt profile
; Minimal sandbox - deny by default, allow only essential operations
(version 1)
(deny default)

; Process operations required for shell functionality
(allow process-fork)
(allow process-exec)
(allow signal (target self))

; System access required for basic functionality
(allow sysctl-read)
(allow file-read-metadata)

; Mach services required for system functionality
(allow mach-lookup)

; Device access for terminals
(allow file-read* (subpath "/dev"))
(allow file-write* (subpath "/dev/null"))
(allow file-write* (subpath "/dev/tty"))
(allow file-ioctl (subpath "/dev"))

; System binaries (read-only)
(allow file-read* (subpath "/usr"))
(allow file-read* (subpath "/bin"))
(allow file-read* (subpath "/sbin"))
(allow file-read* (subpath "/opt"))
(allow file-read* (subpath "/Library"))
(allow file-read* (subpath "/System"))

; Temporary directories (read-write)
(allow file* (subpath "/tmp"))
(allow file* (subpath "/private/tmp"))
(allow file* (subpath "/private/var/folders"))
(allow file* (subpath "/var/folders"))

; Parameters for dynamic paths
; These are substituted at runtime:
; - home: user home directory
; - working_dir: current project directory

; Working directory (parameterized, full access)
; (allow file* (subpath (param "working_dir")))

; Git configuration (read-only)
; (allow file-read* (subpath (string-append (param "home") "/.gitconfig")))
; (allow file-read* (subpath (string-append (param "home") "/.config/git")))

; Denied sensitive paths (these override any allows)
; These are enforced at runtime via deny rules:
; - ~/.ssh
; - ~/.aws
; - ~/.gnupg
; - ~/.config/gh
; - ~/.netrc
; - ~/.docker/config.json
; - ~/Documents
; - ~/Desktop
; - ~/Downloads

; Network: offline by default (no network rules)
